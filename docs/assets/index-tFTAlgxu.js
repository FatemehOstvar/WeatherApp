(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();const P="http://localhost:4000/api";class I{constructor(t){this.tokenProvider=t}async signup(t){return this.#t("/auth/signup","POST",t)}async login(t){return this.#t("/auth/login","POST",t)}async currentUser(){return this.#t("/auth/me","GET")}async#t(t,r,i){const e=this.tokenProvider(),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const s=await fetch(`${P}${t}`,{method:r,headers:n,body:i?JSON.stringify(i):void 0});if(!s.ok){const a=await s.text();let m=a;try{m=JSON.parse(a).message??a}catch{}throw new Error(m||`Request failed with status ${s.status}`)}return s.json()}}class L{data;icon;constructor(t,r){this.city=t,this.unit=r}async extract(){throw new Error("VITE_VISUAL_CROSSING_KEY is not configured.")}async extractCurrent(){return[{temperature:Math.round(await this.data.currentConditions.temp),icon:await this.data.currentConditions.icon,"real feel":await this.data.currentConditions.feelslike,description:await this.data.currentConditions.description,humidity:await this.data.currentConditions.humidity,uvindex:await this.data.currentConditions.uvindex}]}async extractDaily(){const t=await this.data.days,r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return Array.from({length:t.length-1},(i,e)=>({day:r[new Date(t[e].datetime).getDay()],"real feel":t[e].feelslike,humidity:t[e].humidity,icon:t[e].icon,uvindex:t[e].uvindex,temp:Math.round(t[e].temp),tempmin:t[e].tempmin,tempmax:t[e].tempmax,conditions:t[e].conditions}))}async extractHourly(){let t=[...await this.data.days[0].hours,...await this.data.days[1].hours],r=await this.data.currentConditions.datetime.split(":")[0],i;if(parseInt(r)===23)i=0;else for(let e=0;e<48;e++)if(t[e].datetime>r){i=e;break}return t=t.slice(i,24+i),Array.from({length:t.length}).map((e,n)=>({hour:parseInt(t[n].datetime.split(":")[0]),"real feel":t[n].feelslike,humidity:t[n].humidity,icon:t[n].icon,uvindex:t[n].uvindex,temp:Math.round(t[n].temp),conditions:t[n].conditions}))}}const D="modulepreload",b=function(o){return"/WeatherApp/"+o},C={},c=function(t,r,i){let e=Promise.resolve();if(r&&r.length>0){let m=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");e=m(r.map(l=>{if(l=b(l),l in C)return;C[l]=!0;const d=l.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":D,d||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),d)return new Promise((y,O)=>{u.addEventListener("load",y),u.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return e.then(s=>{for(const a of s||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};class R{loaders=Object.assign({"./images/clear-day.svg":()=>c(()=>import("./clear-day-CRDuwQA_.js"),[]).then(t=>t.default),"./images/clear-night.svg":()=>c(()=>import("./clear-night-Bp7tIc4H.js"),[]).then(t=>t.default),"./images/cloudy.svg":()=>c(()=>import("./cloudy-Dw6xiT89.js"),[]).then(t=>t.default),"./images/fog.svg":()=>c(()=>import("./fog-CzCHHV3r.js"),[]).then(t=>t.default),"./images/hail.svg":()=>c(()=>import("./hail-DQYOviUE.js"),[]).then(t=>t.default),"./images/partly-cloudy-day.svg":()=>c(()=>import("./partly-cloudy-day-hOXTbqhV.js"),[]).then(t=>t.default),"./images/partly-cloudy-night.svg":()=>c(()=>import("./partly-cloudy-night-BvRs757O.js"),[]).then(t=>t.default),"./images/rain-snow-showers-day.svg":()=>c(()=>import("./rain-snow-showers-day-DK5D3t5Y.js"),[]).then(t=>t.default),"./images/rain-snow-showers-night.svg":()=>c(()=>import("./rain-snow-showers-night-B5_xwvcP.js"),[]).then(t=>t.default),"./images/rain-snow.svg":()=>c(()=>import("./rain-snow-Dz5o9pem.js"),[]).then(t=>t.default),"./images/rain.svg":()=>c(()=>import("./rain-DAFMpV-X.js"),[]).then(t=>t.default),"./images/showers-day.svg":()=>c(()=>import("./showers-day-tWgaPCup.js"),[]).then(t=>t.default),"./images/showers-night.svg":()=>c(()=>import("./showers-night-DtXg4-AF.js"),[]).then(t=>t.default),"./images/sleet.svg":()=>c(()=>import("./sleet-3vySr0yk.js"),[]).then(t=>t.default),"./images/snow-showers-day.svg":()=>c(()=>import("./snow-showers-day-BN0IjX_d.js"),[]).then(t=>t.default),"./images/snow-showers-night.svg":()=>c(()=>import("./snow-showers-night-Bg0lD470.js"),[]).then(t=>t.default),"./images/snow.svg":()=>c(()=>import("./snow-5h2KdudG.js"),[]).then(t=>t.default),"./images/thunder-rain.svg":()=>c(()=>import("./thunder-rain-YgXXQ_gy.js"),[]).then(t=>t.default),"./images/thunder-showers-day.svg":()=>c(()=>import("./thunder-showers-day-BiwXJGK9.js"),[]).then(t=>t.default),"./images/thunder-showers-night.svg":()=>c(()=>import("./thunder-showers-night-DFcV-VNH.js"),[]).then(t=>t.default),"./images/thunder.svg":()=>c(()=>import("./thunder-C9tiDqg_.js"),[]).then(t=>t.default),"./images/wind.svg":()=>c(()=>import("./wind-BRoNTpPV.js"),[]).then(t=>t.default)});logCity(t){const r=document.querySelector("#city");r.textContent=t}async logCurrent(t,r){const i=Object.fromEntries(t),e=document.querySelector("#current-temp"),n=document.querySelector("#current-icon"),s=document.querySelector("#current-description"),a=document.querySelector("#current-real-feel"),m=document.querySelector("#current-details");e.textContent=`${Math.round(i.temperature)} ${r}`,s.textContent=i.description??i.icon,a.textContent=`Real feel: ${Math.round(i["real feel"])} ${r}`;try{n.src=await this.loadIconUrl(i.icon),n.alt=i.icon??"weather icon"}catch(d){n.removeAttribute("src"),n.alt="weather icon",console.error(d)}m.innerHTML="",[["Humidity",`${i.humidity}%`],["UV Index",i.uvindex]].forEach(([d,h])=>{const u=document.createElement("li");u.innerHTML=`<span>${d}</span><strong>${h}</strong>`,m.appendChild(u)})}async logWeatherAsBG(t){const r=document.querySelector("#app");r.style.backgroundImage=`url(${this.wAnimation()})`,console.log(r)}wAnimation(){return"./animations/windy.webm"}async log(t,r,i){const e=document.querySelector(`#${r}`);e.innerHTML="";for(let n=0;n<t.length;n++){const s=Object.fromEntries(t[n]),a=document.createElement("div");a.className="forecast-card";const m=document.createElement("p");m.className="forecast-title",m.textContent=r==="daily"?s.day:`${String(s.hour).padStart(2,"0")}:00`;const l=document.createElement("img");l.src=await this.loadIconUrl(s.icon),l.alt=s.icon??`${r} icon`;const d=document.createElement("p");d.className="forecast-temp";const h=Number.isFinite(Number(s.temp))?Math.round(Number(s.temp)):s.temp??"-";d.textContent=`${h} ${i}`;const u=document.createElement("p");u.className="forecast-meta";const y=Number.isFinite(Number(s["real feel"]))?`${Math.round(Number(s["real feel"]))} ${i}`:"-";u.textContent=`Feels ${y} • Humidity ${s.humidity}%`,a.appendChild(m),a.appendChild(l),a.appendChild(d),a.appendChild(u),e.appendChild(a)}}loadIconUrl(t){const r=`./images/${t}.svg`,i=this.loaders[r];if(i)return i();const e=this.loaders["./images/partly-cloudy-day.svg"];if(e)return e();throw new Error(`Icon not found: ${t}`)}}class V{organize(t){return Array.from({length:t.length}).map((r,i)=>Object.entries(t[i]).map(([e,n])=>[e,n]))}}class ${constructor(){this.unit="metric",this.enteredCity="Rasht",this.sign={metric:"°C",us:"°F"},this.logger=new R,this.organizer=new V,this.extractor=new L(this.enteredCity,this.unit),this.#t(),this.#r(),this.#e()}async display(){this.logger.logCity(this.enteredCity),await this.extractor.extract();const t=this.organizer.organize(await this.extractor.extractCurrent()),r=this.organizer.organize(await this.extractor.extractDaily()),i=this.organizer.organize(await this.extractor.extractHourly());this.#e(),await this.logger.logCurrent(t[0],this.sign[this.unit]),await this.logger.log(r,"daily",this.sign[this.unit]),await this.logger.log(i,"hourly",this.sign[this.unit]),await this.logger.logWeatherAsBG(t[0][1][1])}async refresh(){this.extractor=new L(this.enteredCity,this.unit),await this.display()}#t(){document.querySelector('button[name="change-city"]')?.addEventListener("click",async()=>{const r=prompt("City?",this.enteredCity);r&&(this.enteredCity=r,await this.refresh())})}#r(){document.querySelector("#thermometer")?.addEventListener("click",async()=>{this.unit=this.unit==="metric"?"us":"metric",await this.refresh()})}#e(){const t=document.querySelector("#thermometer");if(!t)return;t.innerHTML="";const r=this.sign[this.unit]===this.sign.metric;t.textContent=r?"°C":"°F"}}const _="weather-auth-token";let f=localStorage.getItem(_);const S=document.querySelector("#auth-status"),A=document.querySelector("#welcome"),w=document.querySelector("#logout-btn"),x=document.querySelector("#auth-panel"),T=document.querySelector("#weather-shell"),v=new I(()=>f),q=new $;function g(o,t=!1){S.textContent=o,S.className=t?"error":"ok"}function p(o,t){f=t,t&&o?(localStorage.setItem(_,t),A.textContent=`Welcome, ${o.firstName}`,w.classList.remove("hidden"),x.classList.add("hidden"),T.classList.remove("hidden")):(localStorage.removeItem(_),A.textContent="",w.classList.add("hidden"),x.classList.remove("hidden"),T.classList.add("hidden"))}async function N(o){o.preventDefault();const t=o.target.elements["login-email"].value,r=o.target.elements["login-password"].value;try{const{user:i,token:e}=await v.login({email:t,password:r});p(i,e),g("Logged in successfully."),await E()}catch(i){g(i.message,!0)}}async function k(o){o.preventDefault();const t=o.target.elements["signup-first-name"].value,r=o.target.elements["signup-last-name"].value,i=o.target.elements["signup-email"].value,e=o.target.elements["signup-password"].value;try{const{user:n,token:s}=await v.signup({firstName:t,lastName:r,email:i,password:e});p(n,s),g("Account created. You are logged in."),await E()}catch(n){g(n.message,!0)}}async function M(){if(f)try{const{user:o}=await v.currentUser();p(o,f),g("Session restored."),await E()}catch{p(null,null),g("Session expired. Please log in again.",!0)}else g("Log in to personalize your forecast.")}async function E(){try{await q.display()}catch(o){g(o.message,!0)}}w?.addEventListener("click",()=>{p(null,null),g("Signed out.")});document.querySelector("#login-form")?.addEventListener("submit",o=>void N(o));document.querySelector("#signup-form")?.addEventListener("submit",o=>void k(o));await M();
